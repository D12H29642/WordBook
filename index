<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë‹¨ì–´ ì•”ê¸° ì²´í¬ (ì˜ë‚¨ê³  ê¸°ë§)</title>
  <style>
    body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; padding: 12px; background-color: #f9f9f9; }
    h2 { text-align: center; margin: 15px 0 20px; color: #333; }
    
    #controls { text-align: center; margin-bottom: 15px; }
    #btn-reverse {
      background-color: #007bff; color: white; border: none; padding: 10px 20px;
      border-radius: 6px; font-size: 1rem; cursor: pointer; transition: background 0.2s;
    }
    #btn-reverse:hover { background-color: #0056b3; }

    #counters { font-weight: bold; margin-bottom: 15px; text-align:center; font-size: 1.1em; }
    
    .table-wrapper { overflow-x: auto; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px; background: white; }
    table { width: 100%; border-collapse: collapse; font-size: 0.95em; }
    
    th, td { border-bottom: 1px solid #eee; padding: 12px 10px; text-align: left; vertical-align: middle; }
    th { background: #f1f3f5; color: #495057; font-weight: bold; border-top: 2px solid #dee2e6; }
    tr:last-child td { border-bottom: none; }
    
    /* ê°€ë¦¬ê¸° íš¨ê³¼ */
    .conceal { 
      color: transparent; 
      text-shadow: 0 0 8px rgba(0,0,0,0.5); 
      background-color: #e9ecef; 
      border-radius: 4px;
      cursor: pointer; 
      user-select: none;
    }
    
    /* ìƒíƒœ í‘œì‹œ */
    .unknown td { background-color: #fff5f5; }
    .unknown .col-eng, .unknown .col-mean { color: #e03131 !important; font-weight: bold; }
    .known td { background-color: #f8f9fa; color: #adb5bd; }
    
    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    button { cursor: pointer; border: 1px solid #ced4da; background: white; border-radius: 4px; }
    .speak { 
      font-size: 1.2em; border: none; background: none; 
      cursor: pointer; padding: 0 0 0 5px; vertical-align: middle;
    }
    .col-act { white-space: nowrap; width: 120px; text-align: center; }
    .btn-known { margin-right: 5px; color: #2b8a3e; border-color: #2b8a3e; padding: 4px 8px; }
    .btn-known:hover { background: #2b8a3e; color: white; }
    .btn-unknown { color: #c92a2a; border-color: #c92a2a; padding: 4px 8px; }
    .btn-unknown:hover { background: #c92a2a; color: white; }

  </style>
</head>
<body>
  <h2>ì˜ë‚¨ê³  2í•™ê¸° ê¸°ë§ ë‹¨ì–´ì¥</h2>

  <div id="controls">
    <button id="btn-reverse" type="button">ğŸ”„ ë‹¨ì–´/ëœ» ë’¤ì§‘ê¸°</button>
  </div>

  <div id="counters">ì•”ê¸°: 0 | ë¯¸ì•”ê¸°: 0</div>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th style="width: 40%">ì˜ì–´</th>
          <th style="width: 40%">ëœ»</th>
          <th>ìƒíƒœ</th>
        </tr>
      </thead>
      <tbody id="word-body"></tbody>
    </table>
  </div>

  <script>
    // ìš”ì²­í•˜ì‹  ìƒˆë¡œìš´ ë‹¨ì–´ ë¦¬ìŠ¤íŠ¸ (witnessing ì¶”ê°€ë¨)
    const WORDS = [
      { eng: "couldnâ€™t help but", mean: "~í•˜ì§€ ì•Šì„ ìˆ˜ê°€ ì—†ì—ˆë‹¤." },
      { eng: "stay in touch", mean: "ì—°ë½ì„ ì§€ì†í•˜ë‹¤" },
      { eng: "come across", mean: "ìš°ì—°íˆ ë°œê²¬í•˜ë‹¤" },
      { eng: "go a long way", mean: "í° ë„ì›€ì´ ë˜ë‹¤" },
      { eng: "environmental injustice", mean: "í™˜ê²½ì  ë¶ˆí‰ë“±" },
      { eng: "displacement", mean: "í‡´ê±°" },
      { eng: "seep into", mean: "ìŠ¤ë©°ë“¤ë‹¤" },
      { eng: "overdue", mean: "ë¯¸ë¤„ì§„" },
      { eng: "appropriate", mean: "ì ì ˆí•œ" },
      { eng: "deliberate", mean: "ì˜ë„ì ì¸, ì‹ ì¤‘í•œ" },
      { eng: "merit", mean: "ê³µë¡œ, ì¥ì " },
      { eng: "eagerly", mean: "ì ê·¹ì ìœ¼ë¡œ" },
      { eng: "flood in", mean: "ëª°ë ¤ë“¤ë‹¤" },
      { eng: "throne", mean: "ì™•ì¢Œ" },
      { eng: "aggregation", mean: "ì›…ì§‘" },
      { eng: "privileged", mean: "íŠ¹ê¶Œì„ ê°€ì§„" },
      { eng: "permit", mean: "í—ˆìš©í•˜ë‹¤" },
      { eng: "arise", mean: "ìƒê¸°ë‹¤" },
      { eng: "enable A to V", mean: "Aê°€ Ví•˜ëŠ” ê±¸ ê°€ëŠ¥í•˜ê²Œ í•˜ë‹¤" },
      { eng: "orbit around", mean: "~ì£¼ìœ„ë¥¼ ê³µì „í•˜ë‹¤" },
      { eng: "nationality", mean: "êµ­ì " },
      { eng: "citizenship", mean: "ì‹œë¯¼ê¶Œ" },
      { eng: "promote a bill", mean: "ë²•ì•ˆì„ ì¶”ì§„í•˜ë‹¤" },
      { eng: "be elected to", mean: "~ì— ì„ ì¶œë˜ë‹¤" },
      { eng: "fare", mean: "ì‚´ì•„ê°€ë‹¤, ì§€ë‚´ë‹¤" },
      { eng: "preferable", mean: "ë°”ëŒì§í•œ" },
      { eng: "humility", mean: "ê²¸ì†" },
      { eng: "otherwise", mean: "ë‹¬ë¦¬, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´" },
      { eng: "witnessing", mean: "ëª©ê²©í•˜ë‹¤" },
      { eng: "transparency", mean: "íˆ¬ëª…ì„±" },
      { eng: "bank with", mean: "~ì™€ ê±°ë˜í•˜ë‹¤" },
      { eng: "accountability", mean: "ì±…ì„ì„±" },
      { eng: "ethical", mean: "ìœ¤ë¦¬ì ì¸" },
      { eng: "expect", mean: "ê¸°ëŒ€í•˜ë‹¤" },
      { eng: "be committed to", mean: "ì „ë…í•˜ë‹¤" },
      { eng: "ensure", mean: "í™•ì‹¤íˆ í•˜ë‹¤, ë³´ì¥í•˜ë‹¤" },
      { eng: "supposed", mean: "~ë¼ê³  ì—¬ê²¨ì§€ëŠ”" },
      { eng: "persist", mean: "ì§€ì†ë˜ë‹¤" },
      { eng: "determine", mean: "ë°í˜€ë‚´ë‹¤" },
      { eng: "be corrected", mean: "ìˆ˜ì •ë˜ë‹¤" },
      { eng: "discrimination", mean: "ì‹ë³„" },
      { eng: "markedly", mean: "ë‘ë“œëŸ¬ì§€ê²Œ" },
      { eng: "up to", mean: "~ê¹Œì§€" },
      { eng: "trope", mean: "ê´€ë…, ìƒíˆ¬ì  í‘œí˜„" },
      { eng: "bidirectionality", mean: "ì–‘ë°©í–¥ì„±" },
      { eng: "adjust", mean: "ì¡°ì ˆí•˜ë‹¤" },
      { eng: "anticipation", mean: "ê¸°ëŒ€, ì˜ˆìƒ" },
      { eng: "extend oneself", mean: "ìŠ¤ìŠ¤ë¡œë¥¼ í™•ì¥í•˜ë‹¤, ë…¸ë ¥í•˜ë‹¤" },
      { eng: "sentient", mean: "ì§€ê° ëŠ¥ë ¥ì´ ìˆëŠ”" },
      { eng: "independent of", mean: "~ì™€ ë¬´ê´€í•œ" },
      { eng: "retention", mean: "ìœ ì§€, ë³´ì¡´" },
      { eng: "periodic", mean: "ì£¼ê¸°ì ì¸" },
      { eng: "whereas", mean: "ë°˜ë©´ì—" },
      { eng: "serve", mean: "ì‘ìš©í•˜ë‹¤" },
      { eng: "stabilized", mean: "ì•ˆì •í™”ëœ" },
      { eng: "take for granted", mean: "ë‹¹ì—°í•˜ê²Œ ì—¬ê¸°ë‹¤" },
      { eng: "inspection", mean: "ì¡°ì‚¬, ê²€í† " },
      { eng: "be propelled(propelì˜ ìˆ˜ë™íƒœ)", mean: "ì¶”ì§„ë˜ë‹¤" },
      { eng: "recur", mean: "ë°˜ë³µë˜ë‹¤" },
      { eng: "choreography", mean: "ì•ˆë¬´, ì›€ì§ì„ì˜ íŒ¨í„´" },
      { eng: "nurture", mean: "ì–‘ìœ¡, í›„ì²œì  ì˜í–¥" },
      { eng: "metric", mean: "ì¸¡ì • ê¸°ì¤€" },
      { eng: "collectively", mean: "ì§‘ë‹¨ì ìœ¼ë¡œ" },
      { eng: "relative", mean: "ë™ì¡±" },
      { eng: "outdated", mean: "êµ¬ì‹ì˜" },
      { eng: "indefinitely", mean: "ëì—†ì´" },
      { eng: "division", mean: "ë¶€ì„œ" },
      { eng: "invent", mean: "ê³ ì•ˆí•˜ë‹¤" },
      { eng: "preexisting", mean: "ë¯¸ë¦¬ ì¡´ì¬í•˜ëŠ”" },
      { eng: "identical", mean: "ë™ì¼í•œ" },
      { eng: "appeal", mean: "ë§¤ë ¥, í˜¸ì†Œë ¥" },
      { eng: "illusory", mean: "í™˜ìƒì˜" },
      { eng: "out of", mean: "ì¤‘(ä¸­)" },
      { eng: "divergent thinking", mean: "í™•ì‚°ì  ì‚¬ê³ " },
      { eng: "derivative", mean: "ëª¨ë°©ì ì¸" },
      { eng: "constraint", mean: "ì œì•½, ì œí•œ" },
      { eng: "refine", mean: "ë‹¤ë“¬ë‹¤, ê°œì„ í•˜ë‹¤" },
      { eng: "willingness", mean: "ì˜ì§€, ê¸°êº¼ì´ í•˜ë ¤ëŠ” ë§ˆìŒ" },
      { eng: "broke", mean: "ë¬´ì¼í‘¼ì˜" },
      { eng: "hesitate", mean: "ì£¼ì €í•˜ë‹¤" },
      { eng: "compensate", mean: "ë³´ìƒí•˜ë‹¤, ë³´ë‹µí•˜ë‹¤" },
      { eng: "generosity", mean: "ê´€ëŒ€í•¨" },
      { eng: "wealthy", mean: "ë¶€ìœ í•œ" }
    ];

    let knownCount = 0;
    let unknownCount = 0;
    let reversed = false;
    let voices = [];

    // --- ìŒì„± ì¸ì‹(TTS) ê°œì„  ì½”ë“œ ---
    // ëª©ì†Œë¦¬ ëª©ë¡ì´ ë¹„ë™ê¸°ë¡œ ë¡œë“œë˜ë¯€ë¡œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¡œ ëŒ€ê¸°
    function loadVoices() {
      voices = window.speechSynthesis.getVoices();
    }
    
    // ë¸Œë¼ìš°ì €ë³„ í˜¸í™˜ì„±ì„ ìœ„í•´ ì´ë²¤íŠ¸ ë°”ì¸ë”©
    if (window.speechSynthesis.onvoiceschanged !== undefined) {
      window.speechSynthesis.onvoiceschanged = loadVoices;
    }
    loadVoices(); // ì´ˆê¸° ì‹¤í–‰

    function speak(text) {
      // 1. ê¸°ì¡´ ë°œìŒ ì¤‘ë‹¨ (ë²„ë²…ì„ ë°©ì§€)
      window.speechSynthesis.cancel();

      // 2. í…ìŠ¤íŠ¸ ì •ì œ: ì˜ì–´ ë‹¨ì–´ ì¹¸ì— ìˆëŠ” í•œê¸€ì´ë‚˜ ê´„í˜¸ ì•ˆì˜ ì„¤ëª…ì„ ì œê±°í•˜ê³  ì˜ì–´ë§Œ ë°œìŒí•˜ë„ë¡ í•„í„°ë§
      // ì˜ˆ: "be propelled(propelì˜ ìˆ˜ë™íƒœ)" -> "be propelled"
      const cleanText = text.replace(/\(.*\)/g, '').replace(/[^a-zA-Z\sâ€™'-]/g, '').trim();

      const u = new SpeechSynthesisUtterance(cleanText);
      u.lang = 'en-US';
      u.rate = 0.9; // ë“£ê¸° ì¢‹ê²Œ ì•½ê°„ ì²œì²œíˆ

      // 3. ìµœì ì˜ ëª©ì†Œë¦¬ ì°¾ê¸° (Google, Apple ë“± ì˜ì–´ê¶Œ ëª©ì†Œë¦¬ ìš°ì„  ì„ íƒ)
      if (voices.length > 0) {
        const preferredVoice = voices.find(v => 
          (v.name.includes('Google') && v.lang.includes('en-US')) || 
          v.lang === 'en-US' || 
          v.lang.startsWith('en')
        );
        if (preferredVoice) {
          u.voice = preferredVoice;
        }
      }

      window.speechSynthesis.speak(u);
    }
    // ----------------------------

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, m => (
        { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m]
      ));
    }

    function updateCounters() {
      document.getElementById('counters').textContent = `ì•”ê¸°: ${knownCount} | ë¯¸ì•”ê¸°: ${unknownCount}`;
    }

    function setEnglishCellContent(td, text) {
      // í…ìŠ¤íŠ¸ëŠ” ì›ë³¸ ê·¸ëŒ€ë¡œ ë³´ì—¬ì£¼ë˜, ë°œìŒ ë²„íŠ¼ì—ëŠ” ì›ë³¸ í…ìŠ¤íŠ¸ë¥¼ ì „ë‹¬
      td.innerHTML = `<span>${escapeHtml(text)}</span> <button class="speak" aria-label="ë“£ê¸°">ğŸ”Š</button>`;
      // ë²„íŠ¼ì— í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì§ì ‘ ì—°ê²° (ì´ë²¤íŠ¸ ìœ„ì„ë³´ë‹¤ ëª…í™•í•˜ê²Œ ì²˜ë¦¬)
      const btn = td.querySelector('.speak');
      btn.onclick = (e) => {
        e.stopPropagation(); // ì…€ í´ë¦­(ê°€ë¦¬ê¸°) ì´ë²¤íŠ¸ ë°©ì§€
        speak(text);
      };
    }

    function buildTable() {
      const tb = document.getElementById('word-body');
      tb.innerHTML = '';
      
      WORDS.forEach((item) => {
        const tr = document.createElement('tr');
        
        // ì˜ì–´ ì…€
        const tdEng = document.createElement('td');
        tdEng.className = 'col-eng';
        tdEng.dataset.original = item.eng;
        setEnglishCellContent(tdEng, item.eng);
        
        // ëœ» ì…€
        const tdMean = document.createElement('td');
        tdMean.className = 'col-mean';
        tdMean.dataset.meaning = item.mean;
        tdMean.textContent = item.mean;
        
        // ë²„íŠ¼ ì…€
        const tdAct = document.createElement('td');
        tdAct.className = 'col-act';
        tdAct.innerHTML = `<button class="btn-known">ì•”ê¸°</button><button class="btn-unknown">ë¯¸ì•”ê¸°</button>`;
        
        tr.append(tdEng, tdMean, tdAct);
        tb.appendChild(tr);
      });
      
      knownCount = 0; unknownCount = 0; updateCounters(); applyConceal();
    }

    function mark(btn, type) {
      const row = btn.closest('tr');
      const tb  = row.parentNode;
      
      if (type === 'known') {
        if (!row.classList.contains('known')) {
          knownCount++;
          if (row.classList.contains('unknown')) unknownCount--;
          row.classList.add('known');
          row.classList.remove('unknown');
        }
      } else if (type === 'unknown') {
        if (!row.classList.contains('unknown')) {
          unknownCount++;
          if (row.classList.contains('known')) knownCount--;
          row.classList.add('unknown');
          row.classList.remove('known');
          // ë¯¸ì•”ê¸° ì‹œ ë§¨ ìœ„ë¡œ ì´ë™
          tb.insertBefore(row, tb.firstChild);
        }
      }
      updateCounters();
    }

    function applyConceal() {
      // í˜„ì¬ ìƒíƒœ(reversed ì—¬ë¶€)ì— ë”°ë¼ í…ìŠ¤íŠ¸ ê°€ë¦¬ê¸°
      document.querySelectorAll('#word-body tr').forEach(r => {
        const eng = r.querySelector('.col-eng');
        const mean = r.querySelector('.col-mean');
        if(!eng || !mean) return;

        // ë¨¼ì € ë‹¤ ë³´ì´ê²Œ ì´ˆê¸°í™”
        eng.classList.remove('conceal');
        mean.classList.remove('conceal');
        
        // ìŠ¤í”¼ì»¤ ë²„íŠ¼ ì¬ìƒì„±ì„ ìœ„í•´ í…ìŠ¤íŠ¸ ë³µêµ¬
        if(!eng.querySelector('button')) setEnglishCellContent(eng, eng.dataset.original);
        mean.textContent = mean.dataset.meaning;

        // ê°€ë ¤ì•¼ í•  íƒ€ê²Ÿ ì„¤ì •
        const target = reversed ? eng : mean;
        
        // í…ìŠ¤íŠ¸ë¥¼ ìˆ¨ê¸°ê³  í´ë¦­ ìœ ë„ ë©”ì‹œì§€ë¡œ ë³€ê²½
        target.textContent = 'í´ë¦­í•´ ë³´ê¸°';
        target.classList.add('conceal');
      });
    }

    function handleConcealClick(td) {
      if (!td.classList.contains('conceal')) {
        // ì´ë¯¸ ë³´ì—¬ì§„ ìƒíƒœë¼ë©´ ë‹¤ì‹œ ê°€ë¦¬ê¸° (í† ê¸€ ê¸°ëŠ¥)
        const row = td.closest('tr');
        const eng = row.querySelector('.col-eng');
        const mean = row.querySelector('.col-mean');
        
        // í˜„ì¬ ëª¨ë“œì— ë§ëŠ” ì»¬ëŸ¼ì¸ì§€ í™•ì¸
        const target = reversed ? eng : mean;
        if (td === target) {
          td.textContent = 'í´ë¦­í•´ ë³´ê¸°';
          td.classList.add('conceal');
        }
        return;
      }

      // ê°€ë ¤ì§„ ìƒíƒœ -> ë³´ì—¬ì£¼ê¸°
      if (td.classList.contains('col-eng')) {
        setEnglishCellContent(td, td.dataset.original);
      } else {
        td.textContent = td.dataset.meaning;
      }
      td.classList.remove('conceal');
    }

    function reverseCols() {
      reversed = !reversed;
      const ths = document.querySelectorAll('thead th');
      // í—¤ë” í…ìŠ¤íŠ¸ ë³€ê²½ (ì‹œê°ì  í”¼ë“œë°±)
      if (reversed) {
        ths[0].textContent = "ëœ»";
        ths[1].textContent = "ì˜ì–´";
      } else {
        ths[0].textContent = "ì˜ì–´";
        ths[1].textContent = "ëœ»";
      }
      
      // ì‹¤ì œ DOM ìˆœì„œ ë°”ê¾¸ê¸°
      document.querySelectorAll('#word-body tr').forEach(r => {
        const cells = Array.from(r.children);
        if (cells.length < 3) return;
        r.append(cells[1], cells[0], cells[2]);
      });
      applyConceal();
    }

    // ì´ë²¤íŠ¸ ìœ„ì„
    document.addEventListener('click', (e) => {
      // ìŠ¤í”¼ì»¤ ë²„íŠ¼ì€ ë³„ë„ onclickìœ¼ë¡œ ì²˜ë¦¬í–ˆìœ¼ë¯€ë¡œ ì œì™¸
      if (e.target.matches('.btn-known')) {
        mark(e.target, 'known');
        return;
      }
      if (e.target.matches('.btn-unknown')) {
        mark(e.target, 'unknown');
        return;
      }
      
      const td = e.target.closest('td');
      if (td && (td.classList.contains('col-eng') || td.classList.contains('col-mean'))) {
        handleConcealClick(td);
      }
    });

    document.getElementById('btn-reverse').addEventListener('click', reverseCols);

    // ì´ˆê¸°í™”
    buildTable();
  </script>
</body>
</html>
